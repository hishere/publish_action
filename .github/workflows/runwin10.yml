name: è¿è¡Œwin10_kong
on:
  push:
    paths:
      - '.github/workflows/runwin10.yml'

jobs:
  unzip_and_screenshot:
    timeout-minutes: 190
    env:
      ACTIONS_RUNNER_HOOK_JOB_COMPLETED: ""
    runs-on: windows-2022
    steps:
      # 1. æ£€å‡ºä»£ç 
      - uses: actions/checkout@v4
        with:
          sparse-checkout: |
            sss.ps1
            askk.exe
            do_unhide.ps1
          sparse-checkout-cone-mode: false  # ğŸ”§ å…³é”®è®¾ç½®ï¼
          # 3. å¯åŠ¨è¿è¿æ§å¹¶ç­‰å¾…5ç§’
      - name: Run kong and Wait
        shell: pwsh
        run: |
          .\sss.ps1
      # 4. å±å¹•æˆªå›¾ï¼ˆä½¿ç”¨Windowså†…ç½®å·¥å…·ï¼‰
      - name: Take Screenshot
        shell: pwsh
        run: |
          $screenshotPath = "$env:RUNNER_TEMP\screenshot.png"

          Add-Type -AssemblyName System.Windows.Forms
          Add-Type -AssemblyName System.Drawing
            
          $screen = [System.Windows.Forms.Screen]::PrimaryScreen
          $bounds = $screen.Bounds
          $bitmap = New-Object System.Drawing.Bitmap $bounds.Width, $bounds.Height
          $graphics = [System.Drawing.Graphics]::FromImage($bitmap)
          $graphics.CopyFromScreen($bounds.Location, [System.Drawing.Point]::Empty, $bounds.Size)
          $bitmap.Save($screenshotPath, [System.Drawing.Imaging.ImageFormat]::Png)
          $graphics.Dispose()
          $bitmap.Dispose()
            
          echo "SCREENSHOT_PATH=$screenshotPath" >> $env:GITHUB_ENV


      # 5. é€šè¿‡é‚®ä»¶å‘é€æˆªå›¾
      - name: send mail
        uses: dawidd6/action-send-mail@v3
        with:
          server_address: smtp.qq.com
          server_port: 465
          secure: true
          username: 1971902975@qq.com
          password: otxoismbtaqucddg
          from: github action
          to: nooneb1998@foxmail.com
          subject: è¿è¡Œæˆªå›¾
          body: file://output.txt
          attachments: ${{ env.SCREENSHOT_PATH }}  # é™„åŠ æˆªå›¾
       
      - name: run some config
        shell: pwsh
        run: |
          .\do_unhide.ps1    
                    
      - name: Hold for 90 minutes
        run: Start-Sleep -Seconds 15600
        timeout-minutes: 190          